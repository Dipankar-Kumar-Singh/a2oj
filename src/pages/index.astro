---
import Layout from '../layouts/Layout.astro';
import type { Quote, LadderData } from '../types';
import { laddersIndex, getLadderOverride } from '../utils/ladders';
import quotesJson from '../data/quotes.json';

const quotes = quotesJson as readonly Quote[];
const ladderFiles = import.meta.glob<{ default: LadderData }>('../data/ladders/ladder-*.json', { eager: true });
const ladderProblems: Record<string, readonly string[]> = {};

for (const path in ladderFiles) {
	const data = ladderFiles[path].default;
	if (data?.id && data?.problems) {
		ladderProblems[String(data.id)] = data.problems.map(p => `${p.contestId}${p.problemId}`);
	}
}

const ladders = laddersIndex.rating.map((ladder, index) => {
	const override = getLadderOverride(ladder.id);
	return {
		id: ladder.id,
		name: override?.displayName ?? ladder.name,
		count: ladder.problemCount,
		difficulty: override?.difficultyLabel ?? 'Unknown',
		index: index + 1,
	};
});

const divisionLadders = laddersIndex.division.map((ladder) => {
	const override = getLadderOverride(ladder.id);
	return {
		id: ladder.id,
		name: override?.displayName ?? ladder.name,
		count: ladder.problemCount,
		division: override?.division ?? 'Division',
		problemType: override?.problemType ?? '',
	};
});

const extraLadders = laddersIndex.extra.map((ladder, index) => {
	const override = getLadderOverride(ladder.id);
	return {
		id: ladder.id,
		name: override?.displayName ?? ladder.name,
		count: ladder.problemCount,
		difficulty: override?.difficultyLabel ?? 'Unknown',
		index: index + 1,
	};
});

const pageData = { ladderProblems };
---

<Layout title="A2OJ Refreshed - Practice Ladders">
	<main class="min-h-screen full-page-grid">
		<!-- Hero Section with Quote and Controls -->
		<div class="engineering-hero-compact relative">
			<div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
				
				<!-- Rotating Quote Section -->
				<div class="quote-container" id="quote-container">
					<blockquote class="quote-text" id="quote-text">
						"{quotes[0].quote}"
					</blockquote>
					<div class="quote-attribution">
						<span class="quote-author" id="quote-author">— {quotes[0].author}</span>
						<a 
							href={quotes[0].source_url} 
							target="_blank" 
							rel="noopener noreferrer" 
							class="quote-source-link"
							id="quote-source-link"
							title="View source"
						>
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
							</svg>
						</a>
					</div>
				</div>

				<!-- Header Row: Project Label + User Input -->
				<div class="flex flex-col sm:flex-row items-center justify-between gap-4 mt-6">
					<!-- Project Label -->
					<div class="engineering-hero-label">
						<span class="engineering-hero-label-text">PROJECT // A2OJ.REFRESHED</span>
					</div>
					
					<!-- User Handle Input -->
					<div class="flex items-end gap-3">
						<div class="engineering-hero-input-box-compact">
							<span class="engineering-input-label">USER.HANDLE</span>
							<input 
								type="text" 
								id="cf-handle-input"
								placeholder="Enter your Codeforces handle"
								class="engineering-input-compact"
							/>
						</div>
						<button id="track-button" class="engineering-button-compact">
							<span class="engineering-button-icon">▶</span>
							Track
						</button>
						<!-- Sync Status (shows when user is tracked) -->
						<div id="sync-status" class="hidden items-end gap-2">
							<button id="sync-button" class="engineering-sync-button" title="Refresh progress from Codeforces">
								<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
								</svg>
							</button>
							<span id="last-sync" class="engineering-sync-time"></span>
						</div>
						
						<!-- Theme Toggle -->
						<button id="theme-toggle" class="engineering-icon-btn" title="Toggle Dark Mode">
							<svg class="w-4 h-4 sun-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
								<circle cx="12" cy="12" r="4" />
								<path d="M12 2v2m0 16v2m10-10h-2M4 12H2m15.364 6.364l-1.414-1.414M7.05 7.05L5.636 5.636m12.728 0l-1.414 1.414M7.05 16.95l-1.414 1.414" />
							</svg>
							<svg class="w-4 h-4 moon-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
								<path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
							</svg>
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 relative">
			<div class="mb-12">
				<div class="section-header">
					<div class="section-header-line"></div>
					<div class="section-header-box">
						<span class="section-header-label">SECTION 01</span>
						<h2 class="section-header-title">Rating-Based Ladders</h2>
					</div>
					<div class="section-header-line flex-1"></div>
					<div class="section-header-corner"></div>
				</div>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
				{ladders.map((ladder) => (
					<a href={`/ladder/${ladder.id}`} class="block card-hover" data-ladder-id={ladder.id}>
						<div class="engineering-card">
							<div class="engineering-card-corner engineering-card-corner-tl"></div>
							<div class="engineering-card-corner engineering-card-corner-tr"></div>
							<div class="engineering-card-corner engineering-card-corner-bl"></div>
							<div class="engineering-card-corner engineering-card-corner-br"></div>
							
							<div class="flex justify-between items-start mb-4">
								<div class="flex-1">
									<span class="engineering-card-label">LADDER {String(ladder.index).padStart(2, '0')}</span>
									<h3 class="engineering-card-title">
										{ladder.name}
									</h3>
								</div>
								<div class="text-right">
									<div class="engineering-card-count text-teal-600 dark:text-teal-400">
										{ladder.count}
									</div>
									<div class="engineering-card-unit">problems</div>
								</div>
							</div>
							
							<div class="engineering-card-divider"></div>
							
							<div class="flex items-center justify-between mt-4">
								<span class="engineering-card-badge">{ladder.difficulty}</span>
								<div class="flex items-center gap-2">
									<div class="ladder-progress-bar w-24 bg-slate-200 dark:bg-slate-700 h-1">
										<div class="ladder-progress-fill bg-teal-500 h-1" style="width: 0%"></div>
									</div>
									<span class="ladder-progress-percent engineering-card-percent">0%</span>
								</div>
							</div>
						</div>
					</a>
				))}
			</div>
		</div>

		<div class="py-16 relative">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="mb-12">
					<div class="section-header">
						<div class="section-header-line"></div>
						<div class="section-header-box">
							<span class="section-header-label">SECTION 02</span>
							<h2 class="section-header-title">Division-Based Ladders</h2>
						</div>
						<div class="section-header-line flex-1"></div>
						<div class="section-header-corner"></div>
					</div>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
					{divisionLadders.map((ladder) => (
						<a href={`/ladder/${ladder.id}`} class="block card-hover">
							<div class="engineering-card engineering-card-amber">
								<div class="engineering-card-corner engineering-card-corner-tl"></div>
								<div class="engineering-card-corner engineering-card-corner-tr"></div>
								<div class="engineering-card-corner engineering-card-corner-bl"></div>
								<div class="engineering-card-corner engineering-card-corner-br"></div>
								
								<span class="engineering-card-label">{ladder.division.toUpperCase()}</span>
								<h3 class="engineering-card-title text-lg">
									{ladder.name}
								</h3>
								
								<div class="engineering-card-divider mt-3"></div>
								
								<div class="flex justify-between items-center mt-3">
									<span class="engineering-card-badge engineering-card-badge-amber">Problem {ladder.problemType}</span>
									<div class="text-right">
										<div class="engineering-card-count text-amber-600 dark:text-amber-400">
											{ladder.count}
										</div>
										<div class="engineering-card-unit">problems</div>
									</div>
								</div>
							</div>
						</a>
					))}
				</div>
			</div>
		</div>

		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 relative">
			<div class="mb-12">
				<div class="section-header">
					<div class="section-header-line"></div>
					<div class="section-header-box">
						<span class="section-header-label">SECTION 03</span>
						<h2 class="section-header-title">Extra Practice Ladders</h2>
					</div>
					<div class="section-header-line flex-1"></div>
					<div class="section-header-corner"></div>
				</div>
				<p class="text-center text-slate-500 dark:text-slate-400 mt-4 text-sm">
					200 additional problems per rating range for extended practice
				</p>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
				{extraLadders.map((ladder) => (
					<a href={`/ladder/${ladder.id}`} class="block card-hover" data-ladder-id={ladder.id}>
						<div class="engineering-card engineering-card-purple">
							<div class="engineering-card-corner engineering-card-corner-tl"></div>
							<div class="engineering-card-corner engineering-card-corner-tr"></div>
							<div class="engineering-card-corner engineering-card-corner-bl"></div>
							<div class="engineering-card-corner engineering-card-corner-br"></div>
							
							<div class="flex justify-between items-start mb-4">
								<div class="flex-1">
									<span class="engineering-card-label">EXTRA {String(ladder.index).padStart(2, '0')}</span>
									<h3 class="engineering-card-title">
										{ladder.name}
									</h3>
								</div>
								<div class="text-right">
									<div class="engineering-card-count text-purple-600 dark:text-purple-400">
										{ladder.count}
									</div>
									<div class="engineering-card-unit">problems</div>
								</div>
							</div>
							
							<div class="engineering-card-divider"></div>
							
							<div class="flex items-center justify-between mt-4">
								<span class="engineering-card-badge engineering-card-badge-purple">{ladder.difficulty}</span>
								<div class="flex items-center gap-2">
									<div class="ladder-progress-bar w-24 bg-slate-200 dark:bg-slate-700 h-1">
										<div class="ladder-progress-fill bg-purple-500 h-1" style="width: 0%"></div>
									</div>
									<span class="ladder-progress-percent engineering-card-percent">0%</span>
								</div>
							</div>
						</div>
					</a>
				))}
			</div>
		</div>

		<footer class="relative py-16 border-t border-slate-200 dark:border-slate-800/50">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="text-center">
					<div class="mb-8">
						<span class="engineering-card-label">ORIGINAL A2OJ LADDER BY</span>
						<a 
							href="https://codeforces.com/blog/entry/71249" 
							target="_blank" 
							rel="noopener noreferrer"
							class="inline-flex items-center gap-2 mt-2 text-teal-600 dark:text-teal-400 hover:text-teal-500 dark:hover:text-teal-300 transition-colors"
							style="font-family: 'JetBrains Mono', monospace; font-size: 0.875rem;"
						>
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
							</svg>
							ahmed_aly (Codeforces Blog)
						</a>
					</div>
					
					<div class="flex flex-col items-center gap-4">
						<span class="engineering-card-label">CONTACT</span>
						<div class="flex flex-wrap items-center justify-center gap-4">
							<!-- Website Link -->
							<a 
								href="https://dipankar.info/" 
								target="_blank" 
								rel="noopener noreferrer"
								class="inline-flex items-center gap-2 px-4 py-2 border border-slate-300 dark:border-slate-700 hover:border-teal-500 dark:hover:border-teal-400 text-slate-600 dark:text-slate-300 hover:text-teal-600 dark:hover:text-teal-400 transition-all"
								style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; letter-spacing: 0.05em;"
							>
								<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
								</svg>
								dipankar.info
							</a>
							
							<!-- X/Twitter Link -->
							<a 
								href="https://x.com/dipankar_ksingh" 
								target="_blank" 
								rel="noopener noreferrer"
								class="inline-flex items-center gap-2 px-4 py-2 border border-slate-300 dark:border-slate-700 hover:border-teal-500 dark:hover:border-teal-400 text-slate-600 dark:text-slate-300 hover:text-teal-600 dark:hover:text-teal-400 transition-all"
								style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; letter-spacing: 0.05em;"
							>
								<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
									<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
								</svg>
								@dipankar_ksingh
							</a>
							
							<!-- LinkedIn Link -->
							<a 
								href="https://www.linkedin.com/in/dipankar-kumar-singh/" 
								target="_blank" 
								rel="noopener noreferrer"
								class="inline-flex items-center gap-2 px-4 py-2 border border-slate-300 dark:border-slate-700 hover:border-teal-500 dark:hover:border-teal-400 text-slate-600 dark:text-slate-300 hover:text-teal-600 dark:hover:text-teal-400 transition-all"
								style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; letter-spacing: 0.05em;"
							>
								<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
									<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
								</svg>
								LinkedIn
							</a>
							
							<!-- Email Link -->
							<a 
								href="mailto:dipankarcode@gmail.com"
								class="inline-flex items-center gap-2 px-4 py-2 border border-slate-300 dark:border-slate-700 hover:border-teal-500 dark:hover:border-teal-400 text-slate-600 dark:text-slate-300 hover:text-teal-600 dark:hover:text-teal-400 transition-all"
								style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; letter-spacing: 0.05em;"
							>
								<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
								</svg>
								dipankarcode@gmail.com
							</a>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</main>
</Layout>

<!-- Page Data for Client-Side Scripts -->
<script type="application/json" id="quotes-data" set:html={JSON.stringify(quotes)}></script>
<script type="application/json" id="page-data" set:html={JSON.stringify(pageData)}></script>

<!-- Client-Side Scripts (TypeScript compiled) -->
<script>
	import '../scripts/quote-rotator';
	import '../scripts/home-page';
</script>

<style>
	@keyframes fade-in {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
	
	.animate-fade-in {
		animation: fade-in 0.8s ease-out;
	}
</style>
